<div class="dashboard-container">
  <!-- Header Section -->
  <div class="dashboard-header">
    <div class="header-content">
      <h1 class="dashboard-title">
        <mat-icon>dashboard</mat-icon>
        Admin Dashboard
      </h1>
      <div class="header-actions">
        <div class="last-updated">
          <mat-icon class="update-icon">schedule</mat-icon>
          Last updated: {{ lastUpdated | date:'short' }}
        </div>
        
        <!-- Auto Refresh Toggle -->
        <mat-slide-toggle 
          [(ngModel)]="autoRefreshEnabled"
          (change)="onToggleAutoRefresh()"
          matTooltip="Auto refresh dashboard">
          Auto refresh
        </mat-slide-toggle>
        
        <!-- Refresh Interval Selector -->
        <mat-form-field appearance="outline" class="refresh-interval">
          <mat-label>Refresh every</mat-label>
          <mat-select 
            [value]="refreshInterval" 
            (selectionChange)="onRefreshIntervalChange($event.value)">
            <mat-option value="15">15 seconds</mat-option>
            <mat-option value="30">30 seconds</mat-option>
            <mat-option value="60">1 minute</mat-option>
            <mat-option value="300">5 minutes</mat-option>
          </mat-select>
        </mat-form-field>
        
        <!-- Manual Refresh Button -->
        <button 
          mat-raised-button 
          color="primary" 
          (click)="onRefresh()"
          [disabled]="loading"
          matTooltip="Refresh dashboard data">
          <mat-icon>refresh</mat-icon>
          Refresh
        </button>
      </div>
    </div>
  </div>

  <!-- Error Message -->
  <mat-card class="error-card" *ngIf="error">
    <mat-card-content>
      <div class="error-content">
        <mat-icon color="warn">error</mat-icon>
        <span>{{ error }}</span>
        <button mat-button color="primary" (click)="onRefresh()">
          Try Again
        </button>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Loading Spinner -->
  <div class="loading-container" *ngIf="loading && !error">
    <mat-spinner diameter="40"></mat-spinner>
    <p>Loading dashboard data...</p>
  </div>

  <!-- Dashboard Content -->
  <div class="dashboard-content" *ngIf="!loading && !error">
    
    <!-- Statistics Cards Grid -->
    <div class="stats-grid">
      <app-stats-card 
        *ngFor="let card of statsCards; trackBy: trackByFn" 
        [card]="card">
      </app-stats-card>
    </div>

    <!-- Charts Section -->
    <div class="charts-section">
      
      <!-- User Growth Chart -->
      <mat-card class="chart-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>trending_up</mat-icon>
            User Growth (Last 30 Days)
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <app-line-chart
            [data]="userGrowthData"
            [height]="'300px'"
            [color]="'#1976d2'"
            [fillArea]="true"
            [tension]="0.3">
          </app-line-chart>
        </mat-card-content>
      </mat-card>

      <!-- Patch Activity Chart -->
      <mat-card class="chart-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>library_music</mat-icon>
            Patch Creation Activity
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <app-line-chart
            [data]="patchActivityData"
            [height]="'300px'"
            [color]="'#388e3c'"
            [fillArea]="false"
            [tension]="0.2">
          </app-line-chart>
        </mat-card-content>
      </mat-card>

      <!-- Category Distribution Chart -->
      <mat-card class="chart-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>category</mat-icon>
            Category Distribution
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <app-donut-chart
            [data]="categoryDistribution"
            [height]="'300px'"
            [centerText]="true"
            [centerLabel]="'Categories'"
            [showPercentages]="true">
          </app-donut-chart>
        </mat-card-content>
      </mat-card>

      <!-- Rating Distribution Chart -->
      <mat-card class="chart-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>star</mat-icon>
            Rating Distribution
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <app-bar-chart
            [data]="ratingDistribution"
            [height]="'300px'"
            [showGrid]="true">
          </app-bar-chart>
        </mat-card-content>
      </mat-card>

    </div>
  </div>
</div>