<div class="moderation-container">
  <!-- Header Section -->
  <div class="page-header">
    <div class="header-content">
      <div class="title-section">
        <h1 class="page-title">
          <mat-icon>gavel</mat-icon>
          Content Moderation
        </h1>
        <p class="page-subtitle">
          Review and moderate user-generated content
        </p>
      </div>
      
      <div class="header-actions">
        <button mat-raised-button color="accent" (click)="onRefresh()" [disabled]="loading">
          <mat-icon>refresh</mat-icon>
          Refresh
        </button>
      </div>
    </div>

    <!-- Search and Quick Filters -->
    <div class="search-section">
      <mat-form-field class="search-field" appearance="outline">
        <mat-label>Search content</mat-label>
        <mat-icon matPrefix>search</mat-icon>
        <input matInput [formControl]="searchControl" placeholder="Search by title, author, or content">
        <button *ngIf="searchControl.value" matSuffix mat-icon-button (click)="searchControl.setValue('')">
          <mat-icon>close</mat-icon>
        </button>
      </mat-form-field>

      <div class="quick-filters">
        <mat-form-field appearance="outline">
          <mat-label>Priority</mat-label>
          <mat-select [(value)]="filters.priority" (selectionChange)="onFilterChange()">
            <mat-option *ngFor="let priority of priorityOptions" [value]="priority.value">
              <div class="filter-option">
                <mat-icon [color]="priority.color">{{ priority.icon }}</mat-icon>
                <span>{{ priority.label }}</span>
              </div>
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Content Type</mat-label>
          <mat-select [(value)]="filters.type" (selectionChange)="onFilterChange()">
            <mat-option *ngFor="let type of typeOptions" [value]="type.value">
              <div class="filter-option">
                <mat-icon>{{ type.icon }}</mat-icon>
                <span>{{ type.label }}</span>
              </div>
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Assignee</mat-label>
          <mat-select [(value)]="filters.assignee" (selectionChange)="onFilterChange()">
            <mat-option *ngFor="let assignee of assigneeOptions" [value]="assignee.value">
              {{ assignee.label }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Date Range</mat-label>
          <mat-select [(value)]="filters.dateRange" (selectionChange)="onFilterChange()">
            <mat-option *ngFor="let range of dateRangeOptions" [value]="range.value">
              {{ range.label }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </div>
  </div>

  <!-- Bulk Operations Bar -->
  <div class="bulk-operations" *ngIf="selection.hasValue()">
    <div class="bulk-info">
      <mat-icon>info</mat-icon>
      <span>{{ selection.selected.length }} item(s) selected</span>
    </div>

    <div class="bulk-actions">
      <button *ngFor="let operation of availableBulkOperations" 
              mat-stroked-button 
              [color]="operation.color"
              (click)="onBulkOperation(operation.value)"
              [disabled]="loading">
        <mat-icon>{{ operation.icon }}</mat-icon>
        {{ operation.label }}
      </button>
    </div>
  </div>

  <!-- Error Display -->
  <mat-card *ngIf="error" class="error-card">
    <mat-card-content>
      <div class="error-content">
        <mat-icon color="warn">error</mat-icon>
        <span>{{ error }}</span>
        <button mat-button color="primary" (click)="onRefresh()">
          Try Again
        </button>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Tabbed Content View -->
  <mat-card class="content-card">
    <mat-tab-group [(selectedIndex)]="activeTabIndex" 
                   (selectedTabChange)="onTabChange($event)"
                   class="moderation-tabs">
      
      <mat-tab *ngFor="let tab of tabs" [label]="tab.label">
        <ng-template mat-tab-label>
          {{ tab.label }}
          <mat-chip *ngIf="tab.badge > 0" 
                   class="tab-badge" 
                   [color]="tab.status === 'pending' ? 'warn' : 'primary'" 
                   selected>
            {{ tab.badge }}
          </mat-chip>
        </ng-template>

        <!-- Tab Content -->
        <div class="tab-content">
          <!-- Moderation Table -->
          <div class="table-container">
            <mat-table [dataSource]="dataSource" 
                       matSort 
                       (matSortChange)="onSortChange($event)"
                       class="moderation-table">

              <!-- Selection Column -->
              <ng-container matColumnDef="select">
                <mat-header-cell *matHeaderCellDef>
                  <mat-checkbox (change)="masterToggle()"
                               [checked]="selection.hasValue() && isAllSelected()"
                               [indeterminate]="selection.hasValue() && !isAllSelected()">
                  </mat-checkbox>
                </mat-header-cell>
                <mat-cell *matCellDef="let item">
                  <mat-checkbox (click)="$event.stopPropagation()"
                               (change)="toggleSelection(item)"
                               [checked]="selection.isSelected(item)">
                  </mat-checkbox>
                </mat-cell>
              </ng-container>

              <!-- Priority Column -->
              <ng-container matColumnDef="priority">
                <mat-header-cell *matHeaderCellDef mat-sort-header>Priority</mat-header-cell>
                <mat-cell *matCellDef="let item">
                  <div class="priority-indicator">
                    <mat-icon [color]="getPriorityColor(item.priority)" 
                             [matTooltip]="item.priority | titlecase">
                      {{ getPriorityIcon(item.priority) }}
                    </mat-icon>
                  </div>
                </mat-cell>
              </ng-container>

              <!-- Type Column -->
              <ng-container matColumnDef="type">
                <mat-header-cell *matHeaderCellDef mat-sort-header>Type</mat-header-cell>
                <mat-cell *matCellDef="let item">
                  <div class="content-type">
                    <mat-icon>{{ getTypeIcon(item.type) }}</mat-icon>
                    <span>{{ item.type | titlecase }}</span>
                  </div>
                </mat-cell>
              </ng-container>

              <!-- Title Column -->
              <ng-container matColumnDef="title">
                <mat-header-cell *matHeaderCellDef mat-sort-header>Title</mat-header-cell>
                <mat-cell *matCellDef="let item">
                  <div class="content-info">
                    <div class="content-title" (click)="onViewItem(item)">
                      {{ item.title }}
                    </div>
                    <div class="content-preview">
                      {{ item.content | slice:0:100 }}{{ item.content.length > 100 ? '...' : '' }}
                    </div>
                  </div>
                </mat-cell>
              </ng-container>

              <!-- Author Column -->
              <ng-container matColumnDef="author">
                <mat-header-cell *matHeaderCellDef mat-sort-header>Author</mat-header-cell>
                <mat-cell *matCellDef="let item">
                  <div class="author-info">
                    <span class="author-name">{{ item.author }}</span>
                    <span class="creation-date">{{ getTimeAgo(item.created_at) }}</span>
                  </div>
                </mat-cell>
              </ng-container>

              <!-- Reports Column -->
              <ng-container matColumnDef="reports">
                <mat-header-cell *matHeaderCellDef mat-sort-header>Reports</mat-header-cell>
                <mat-cell *matCellDef="let item">
                  <mat-chip [color]="item.reports > 1 ? 'warn' : 'primary'" selected>
                    {{ item.reports }}
                  </mat-chip>
                </mat-cell>
              </ng-container>

              <!-- Created At Column -->
              <ng-container matColumnDef="createdAt">
                <mat-header-cell *matHeaderCellDef mat-sort-header>Created</mat-header-cell>
                <mat-cell *matCellDef="let item">
                  <span class="date-info">{{ formatDate(item.created_at) }}</span>
                </mat-cell>
              </ng-container>

              <!-- Assigned To Column -->
              <ng-container matColumnDef="assignedTo">
                <mat-header-cell *matHeaderCellDef>Assigned To</mat-header-cell>
                <mat-cell *matCellDef="let item">
                  <div class="assignee-info">
                    <span *ngIf="item.assignedTo; else unassigned" class="assignee-name">
                      {{ item.assignedTo }}
                    </span>
                    <ng-template #unassigned>
                      <button mat-button 
                             color="primary" 
                             size="small"
                             (click)="onAssignToMe(item)">
                        <mat-icon>person_add</mat-icon>
                        Assign to Me
                      </button>
                    </ng-template>
                  </div>
                </mat-cell>
              </ng-container>

              <!-- Actions Column -->
              <ng-container matColumnDef="actions">
                <mat-header-cell *matHeaderCellDef>Actions</mat-header-cell>
                <mat-cell *matCellDef="let item">
                  <div class="action-buttons">
                    <button *ngFor="let action of quickActions"
                           mat-icon-button 
                           [color]="action.color"
                           (click)="onQuickAction(item, action.value)"
                           [matTooltip]="action.label"
                           [disabled]="loading">
                      <mat-icon>{{ action.icon }}</mat-icon>
                    </button>

                    <button mat-icon-button [matMenuTriggerFor]="itemMenu">
                      <mat-icon>more_vert</mat-icon>
                    </button>
                    
                    <mat-menu #itemMenu="matMenu">
                      <button mat-menu-item (click)="onViewItem(item)">
                        <mat-icon>visibility</mat-icon>
                        <span>View Details</span>
                      </button>
                      <button mat-menu-item (click)="onAssignToMe(item)">
                        <mat-icon>person_add</mat-icon>
                        <span>Assign to Me</span>
                      </button>
                      <mat-divider></mat-divider>
                      <button mat-menu-item (click)="onQuickAction(item, 'approve')">
                        <mat-icon color="primary">check_circle</mat-icon>
                        <span>Approve</span>
                      </button>
                      <button mat-menu-item (click)="onQuickAction(item, 'reject')">
                        <mat-icon color="warn">cancel</mat-icon>
                        <span>Reject</span>
                      </button>
                      <button mat-menu-item (click)="onQuickAction(item, 'escalate')">
                        <mat-icon color="accent">flag</mat-icon>
                        <span>Escalate</span>
                      </button>
                    </mat-menu>
                  </div>
                </mat-cell>
              </ng-container>

              <!-- Table Headers and Rows -->
              <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
              <mat-row *matRowDef="let item; columns: displayedColumns;"
                       [class.selected]="selection.isSelected(item)"
                       (click)="toggleSelection(item)">
              </mat-row>
            </mat-table>

            <!-- Loading Indicator -->
            <div *ngIf="loading" class="loading-container">
              <mat-spinner diameter="40"></mat-spinner>
              <p>Loading moderation items...</p>
            </div>

            <!-- No Data Message -->
            <div *ngIf="!loading && dataSource.data.length === 0" class="no-data-container">
              <mat-icon class="no-data-icon">check_circle</mat-icon>
              <h3>No items found</h3>
              <p>All caught up! No items require moderation in this category.</p>
            </div>

            <!-- Paginator -->
            <mat-paginator [length]="totalItems"
                          [pageSize]="25"
                          [pageSizeOptions]="[10, 25, 50, 100]"
                          (page)="onPageChange()"
                          showFirstLastButtons>
            </mat-paginator>
          </div>
        </div>
      </mat-tab>
    </mat-tab-group>
  </mat-card>

  <!-- Summary Footer -->
  <div class="summary-footer">
    <div class="summary-stats">
      <span class="stat-item">
        <strong>{{ totalItems }}</strong> total items
      </span>
      <span class="stat-item">
        <strong>{{ selection.selected.length }}</strong> selected
      </span>
      <span class="stat-item">
        Last updated: {{ lastUpdated | date:'short' }}
      </span>
    </div>
    
    <div class="auto-refresh-info">
      <mat-icon>autorenew</mat-icon>
      <span>Auto-refreshes every 30 seconds</span>
    </div>
  </div>
</div>